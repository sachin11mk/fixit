{% extends "base.html" %}
{%load common_tags%}

{% block content %}

<!-- ++++++++++++++++  complete task  ++++++++++++++++++  --> 

    <div class="well well-lg" id="ctask-div">
            <h4 style='color:green;'>
                Completed Tasks
                <span class="pull-right">
                    <small title="{{week_done_cnt}} out of {{week_cnt}} tasks complete.">
                        <i style="font-size:14px;">Weekly Fixit Rate: {{task_done_rate}}</i>
                    </small>
                </span>
            </h4>

        {%if c_tasks%}
            <table class="table table-bordered">
                <thead>
                    {%comment%}
                    <th>#</th>
                    {%endcomment%}
                    <th width="12%"><h4><b>Time to fix</b></h4></th>
                    <th width="18%"><h4><b>Location</b></h4></th>
                    <th width="42%"><h4><b>Details</b></h4></th>
                    <th width="8%"><h4><b>Priority</b></h4></th>
                    {%if request.user.is_superuser or request.user.is_staff%}
                        <th></th>
                    {%endif%}
                </thead>
                <tbody>
                    {%for  task in c_tasks%}
                        <!-- <tr>  -->
                        <tr {%if task.repeatable %} style="border-left: solid blue 2px;"{%endif%}>
                    {%comment%}
                            <td>{{forloop.counter|add:ctask_list.next_page_number}}.</td>
                    {%endcomment%}
                            <td width="12%">
                                {% if task.repeatable %}
                                    &nbsp;
                                    <span class="glyphicon glyphicon-repeat"
                                        style="color:blue; font-weight:bold;"
                                        title="">
                                    </span> &nbsp;
                                {%endif%}
                                {%time_required task.id %}

                            </td>
                            <td width="18%">
                                {% show_location task%}
                            </td>
                            <td width="42%" title="{{task.desc}}">
                                {#{task.desc|truncatechars:60}#}
                                {{task.desc}}
                            </td>
                            <td width="8%" style='color:green;'>
                                {% show_priority task%}
                            </td>
                            {%if request.user.is_superuser or request.user.is_staff%}
                                <td>
                                    <!-- Edit link -->
                                    <a href="{%url 'edit_task' task.id%}">Edit </a>
                                    &nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp; 

                                    <!-- Pending link -->
                                    <a title="Mark as pending." href="{%url 'mark_task_pending' task.id%}">Pending</a>

                                    <!-- Delete link -->
                                    {%if request.user.is_superuser%}
                                        &nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp; 
                                        <a id="id-del-task" href="{%url 'delete_task' task.id%}">
                                        <span class="glyphicon glyphicon-trash"></span></a>
                                    {%endif%}
                                </td>
                            {%endif%}
                        </tr>         
                    {%endfor%}

                </tbody>
            </table>

{%comment%}
            <div class="pagination">
                <span class="step-links">
                    {% if ctask_list.has_previous %}
                        <a href="?page={{ ctask_list.previous_page_number }}">previous</a>
                    {% endif %}

                    <span class="current">
                        Page {{ ctask_list.number }} of {{ ctask_list.paginator.num_pages }}.
                    </span>

                    {% if ctask_list.has_next %}
                        <a href="?page={{ ctask_list.next_page_number }}">next</a>
                    {% endif %}
                </span>
            </div>
{%endcomment%}

            <br/>
            <div class="pull-right"> 
                <br/>
                <a href="#top-btn">
                    <span class="glyphicon glyphicon-arrow-up"></span>
                </a>
            </div>
            <br/>
        {%else%}
            No complete tasks found.
        {%endif%}
    </div>

{% endblock content %}


{% block extra_js %}
    <script type="text/javascript">
        $(document).ready(function(){
            $('a#id-del-task').click(function(e){
                var msg = "Do you want to delete task?"
                var isDelete = window.confirm(msg);
                if ( isDelete != true )
                    e.preventDefault();
                $(this).closest('form').trigger('submit');
            });
        });
    </script>
{% endblock extra_js %}
