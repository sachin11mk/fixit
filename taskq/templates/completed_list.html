{% extends "base.html" %}
{%load common_tags%}

{% block content %}

<!-- ++++++++++++++++  complete task  ++++++++++++++++++  --> 

    <div class="well well-lg" id="ctask-div">
            <h4 style='color:green;'>
                Completed Tasks
                <span class="pull-right">
                    <small title="{{week_done_cnt}} out of {{week_cnt}} tasks complete.">
                        <i style="font-size:14px;">Weekly Fixit Rate: {{task_done_rate}}</i>
                    </small>
                </span>
            </h4>

        {%if c_tasks%}
            <br/>
            <table class="table table-bordered" id="task-list-table">
                <thead>
                    <th width="5%"><b>#</b></th>
                    <th width="10%"><b>Time to fix</b></th>
                    <th width="15%"><b>Location</b></th>
                    <th width="42%"><b>Details</b></th>
                    <th width="8%"><b>Priority</b></th>
                    <th width=""><b>admin</b></th>
                    {%if request.user.is_superuser or request.user.is_staff%}
                    {%endif%}
                </thead>
            </table>


            <div id="task-list-scroll">
                <table class="table table-bordered" id="task-list-table-1">
                    <tbody id="task-list-tbody">

                        {%for  task in c_tasks%}
                            <tr {%if task.repeatable %} style="border-left: solid blue 2px;"{%endif%}>
                                <td width="5%">
                                    <small>
                                        {{forloop.counter}}.
                                    </small>
                                </td>
                                <td width="10%">
                                    <small>
                                        {% if task.repeatable %}
                                            &nbsp;
                                            <span class="glyphicon glyphicon-repeat"
                                                style="color:blue; font-weight:bold;"
                                                title="">
                                            </span> &nbsp;
                                        {%endif%}
                                        {%time_required task.id %}
                                    </small>

                                </td>
                                <td width="15%">
                                    <small>
                                        {% show_location task%}
                                    </small>
                                </td>
                                <td width="42%" title="{{task.desc}}">
                                    {#{task.desc|truncatechars:60}#}
                                    <small>
                                        {{task.desc}}
                                    </small>
                                </td>
                                <td width="8%" style='color:green;'>
                                    <small>
                                        {% show_priority task%}
                                    </small>
                                </td>
                                <td width="">
                                    <!-- Edit link -->

                                    <a href="{%if request.user.is_authenticated%} 
                                            {%url 'edit_task' task.id%}
                                        {%else%}
                                            {% url 'socialauth_begin' 'google-oauth2' %} 
                                        {%endif%}">
                                    <span title="Edit" class="glyphicon glyphicon-pencil"></span></a>
                                    {%if request.user.is_superuser or request.user.is_staff%}
                                        &nbsp; | &nbsp;
                                        <!-- Pending link -->
                                        <a title="Mark as pending." href="{%url 'mark_task_pending' task.id%}">
                                            <span title="Pending" class="glyphicon glyphicon-remove"></span></a>

                                        <!-- Delete link -->
                                        {%if request.user.is_superuser%}
                                            &nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp; 
                                            <a id="id-del-task" href="{%url 'delete_task' task.id%}">
                                            <span title="Delete" class="glyphicon glyphicon-trash"></span></a>
                                        {%endif%}
                                    {%endif%}
                                    {%if task.cuser%}
                                        &nbsp; | &nbsp;
                                        <span title="Reporter: {%get_task_cuser task%}" class="glyphicon glyphicon-user"></span>
                                    {%endif%}
                                    {%if task.euser%}
                                        &nbsp; | &nbsp;
                                        <span title="Last Edited: {%get_task_euser task%}" class="glyphicon glyphicon-eye-open"></span>
                                    {%endif%}
                                </td>
                            </tr>         
                        {%endfor%}
                    </tbody>
                </table>
                <br/><br/>
            </div>
            <br/>
        </div>
    {%else%}
            No complete tasks found.
        {%endif%}
    </div>

{% endblock content %}


{% block extra_js %}
    <script type="text/javascript">
        $(document).ready(function(){
            $('a#id-del-task').click(function(e){
                var msg = "Do you want to delete task?"
                var isDelete = window.confirm(msg);
                if ( isDelete != true )
                    e.preventDefault();
                $(this).closest('form').trigger('submit');
            });
        });
    </script>
{% endblock extra_js %}
