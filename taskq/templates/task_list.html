{% extends "base.html" %}
{%load common_tags%}

{% block content %}
    <div class="well well-lg" id="ptask-div">
        {%comment%}
        <blockquote>
            <h3 style='color:red;'>Pending Tasks</h3>
        </blockquote>
        {%endcomment%}
        <table class="table table-bordered" id="task-list-table">
            <thead>
                <th width="5%"><b>#</b></th>
                <th width="11%"><b>Time</b></th>
                <th width="17%"><b>Location</b></th>
                <th width="42%"><b>Details</b></th>
                <th width="8%"><b>Priority</b></th>
                {%if request.user.is_superuser or request.user.is_staff%}
                    <th width=""><b>admin</b></th>
                {%endif%}
            </thead>
        </table>

        <div id="task-list-scroll">
            <table class="table table-bordered" id="task-list-table-1">
                <tbody id="task-list-tbody">
                    {%for  task in p_tasks%}
                        <tr {%if task.repeatable %} style="border-left: solid blue 2px;" 
                            {%elif task.status == 'I'%} style="border-left: solid green 2px;"
                            {%endif%}>
                    
                            <td width="5%">
                                <small>
                                    {{forloop.counter}}.
                                </small>
                            </td>
                            <td width="11%">
                                <small>
                                    {% if task.repeatable %}
                                        &nbsp;
                                        <span class="glyphicon glyphicon-repeat"
                                            style="color:blue; font-weight:bold;"
                                            title="Timeout: {{task.repeat_time}}">
                                        </span>&nbsp;
                                        {%repeat_timesince task.id %}
                                    {% else %}
                                        {%pending_timesince task.id %}
                                    {%endif%}
                                </small>
                            </td>
                            <td width="17%">
                                <small>
                                    {% show_location task%}
                                </small>
                            </td>
                            <td width="42%" title="{{task.desc}}">
                                {#{task.desc|truncatechars:60}#}
                                <small>
                                    {{task.desc}}
                                </small>
                            </td>
                            <td width="8%" {%if task.status == 'I' %}
                                    style='background:#BEF781;' title="In-Progress"{%endif%}>
                                <small>
                                    {% show_pending_priority task %} 
                                </small>
                            </td>
                            {%if request.user.is_superuser or request.user.is_staff%}
                                <td width="">
                                    <!-- Edit link -->
                                    <a href="{%url 'edit_task' task.id%}">
                                        <span title="Edit" class="glyphicon glyphicon-pencil"></span></a>
                                    &nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp; 

                                    <!-- Done link -->
                                    <a title="Mark as done." href="{%url 'mark_task_complete' task.id%}">
                                        <span title="Done" class="glyphicon glyphicon-ok"></span></a>
                                    
                                    <!-- Delete link -->
                                    {%if request.user.is_superuser%}
                                        &nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp; 
                                        <a id="id-del-task" href="{%url 'delete_task' task.id%}">
                                        <span title="Delete" class="glyphicon glyphicon-trash"></span></a>
                                    {%endif%}
                                </td>
                            {%endif%}
                        </tr>         
                    {%endfor%}

                </tbody>
            </table>
            <br/><br/>
        </div>
        <br/>
    </div>
{% endblock content %}


{% block extra_js %}
    <script type="text/javascript">
        $(document).ready(function(){
            $('a#id-del-task').click(function(e){
                var msg = "Do you want to delete task?"
                var isDelete = window.confirm(msg);
                if ( isDelete != true )
                    e.preventDefault();
                $(this).closest('form').trigger('submit');
            });
        });
    </script>
{% endblock extra_js %}
