{% extends "base.html" %}
{%load common_tags%}

{% block content %}
    <div class="well well-lg" id="ptask-div">
        {%comment%}
        <blockquote>
            <h3 style='color:red;'>Pending Tasks</h3>
        </blockquote>
        {%endcomment%}
        <table class="table table-bordered">
            <thead>
                <th width="12%"><h4><b>Time</b></h4></th>
                {%comment%}
                {%endcomment%}
                <th width="18%"><h4><b>Location</b></h4></th>
                <th width="42%"><h4><b>Details</b></h4></th>
                <th width="8%"><h4><b>Priority</b></h4></th>
                {%if request.user.is_superuser or request.user.is_staff%}
                    <th></th>
                {%endif%}
            </thead>
            <tbody>
                {%for  task in p_tasks%}
                    <tr {%if task.repeatable %} style="border-left: solid blue 2px;"{%endif%}>
                        <td width="12%">
                            <small>
                                {% if task.repeatable %}
                                    &nbsp;
                                    <span class="glyphicon glyphicon-repeat"
                                        style="color:blue; font-weight:bold;"
                                        title="Timeout: {{task.repeat_time}}">
                                    </span>&nbsp;
                                    {%repeat_timesince task.id %}
                                {% else %}
                                    {%pending_timesince task.id %}
                                {%endif%}
                            </small>
                        </td>
                {%comment%}
                        <td>{{forloop.counter|add:ptask_list.next_page_number}}.</td>
                {%endcomment%}
                        <td width="18%">
                            {% show_location task%}
                        </td>
                        <td width="42%" title="{{task.desc}}">
                            {#{task.desc|truncatechars:60}#}
                            {{task.desc}}
                        </td>
                        <td width="8%">
                            {% show_pending_priority task %}
                        </td>
                        {%if request.user.is_superuser or request.user.is_staff%}
                            <td>
                                <!-- Edit link -->
                                <a href="{%url 'edit_task' task.id%}">Edit </a>
                                &nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp; 

                                <!-- Done link -->
                                <a title="Mark as done." href="{%url 'mark_task_complete' task.id%}">Done</a>
                                
                                <!-- Delete link -->
                                {%if request.user.is_superuser%}
                                    &nbsp;&nbsp;&nbsp; | &nbsp;&nbsp;&nbsp; 
                                    <a id="id-del-task" href="{%url 'delete_task' task.id%}">
                                    <span class="glyphicon glyphicon-trash"></span></a>
                                {%endif%}
                            </td>
                        {%endif%}
                    </tr>         
                {%endfor%}

            </tbody>
        </table>

{%comment%}
        <div class="pagination">
            <span class="step-links">
                {% if ptask_list.has_previous %}
                    <a href="?page={{ ptask_list.previous_page_number }}">previous</a>
                {% endif %}

                <span class="current">
                    Page {{ ptask_list.number }} of {{ ptask_list.paginator.num_pages }}.
                </span>

                {% if ptask_list.has_next %}
                    <a href="?page={{ ptask_list.next_page_number }}">next</a>
                {% endif %}
            </span>
        </div>
{%endcomment%}
        
        <br/>
        <div class="pull-right"> 
            <br/>
            <a href="#top-btn">
                <span class="glyphicon glyphicon-arrow-up"></span>
            </a>
        </div>
        <br/>

    </div>

{% endblock content %}


{% block extra_js %}
    <script type="text/javascript">
        $(document).ready(function(){
            $('a#id-del-task').click(function(e){
                var msg = "Do you want to delete task?"
                var isDelete = window.confirm(msg);
                if ( isDelete != true )
                    e.preventDefault();
                $(this).closest('form').trigger('submit');
            });
        });
    </script>
{% endblock extra_js %}
